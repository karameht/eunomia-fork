#!/usr/bin/env sh

echo "ğŸš€ EUNOMIA Pre-Push Validation"
echo "=============================="

# Get current branch
current_branch=$(git symbolic-ref --short HEAD)
echo "ğŸ“ Current branch: $current_branch"

# Main/Master branch protection
if [ "$current_branch" = "main" ] || [ "$current_branch" = "master" ]; then
  echo "âš ï¸  WARNING: You're pushing to $current_branch!"
  echo "ğŸ¤” Are you sure? This should usually be done via Pull Request. (y/N)"
  read -r response
  if [ "$response" != "y" ] && [ "$response" != "Y" ]; then
    echo "âŒ Push cancelled for safety."
    exit 1
  fi
fi

# Full build test
echo "ğŸ—ï¸  Running full build test..."
yarn build

if [ $? -ne 0 ]; then
  echo "âŒ Build failed! Cannot push broken code."
  exit 1
fi

# Cleanup build artifacts (optional)
echo "ğŸ§¹ Cleaning up build artifacts..."
rm -rf dist

echo "âœ… Pre-push validation complete!"
echo "ğŸš€ Safe to push to $current_branch"
echo "=============================="
